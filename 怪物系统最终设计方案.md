# 怪物系统最终设计方案

## 怪物分类

### 1. 普通怪物（土匪、黄巾军、绿林匪寇、逃兵）

**用途**：
- 玩家击败获取经验值升级
- 击败获取装备物品
- 日常刷怪练级

**特点**：
- ✅ 每个玩家独立生成（客户端生成）
- ✅ 击败后立即消失
- ✅ 不需要跨玩家同步
- ❌ 不需要存储实例到数据库

**实现方式**：
- 客户端从服务器获取怪物模板
- 客户端按模板生成怪物实例
- 击败后客户端直接销毁，不通知服务器（或仅通知服务器记录击败数据用于统计）

---

### 2. 王城战Boss（特殊怪物）

**用途**：
- 王城战战场中的中立Boss
- 两个家族（A方和B方）争夺
- 击败后归属击败者家族，增加家族积分

**特点**：
- ✅ 服务器生成和控制
- ✅ 所有玩家看到同一个Boss
- ✅ 需要实时同步状态（生命值、归属等）
- ✅ 需要存储实例到数据库
- ✅ 初始无归属（中立）
- ✅ 最后击败者家族获得归属
- ✅ 击败后增加家族积分

**实现方式**：
- 服务器创建王城战战场时生成Boss
- Boss状态存储在数据库
- 通过WebSocket实时同步Boss状态
- 击败后更新归属和积分

---

## 数据库设计

### 1. 怪物模板表（monster_templates）- 必须

**用途**：存储所有怪物的基础配置

**包含字段**：
- 怪物类型、名称
- 基础属性（生命值、攻击力、防御力）
- 掉落奖励（铜钱、经验值）
- 是否为Boss标记

**适用场景**：
- 普通怪物：客户端按模板生成
- Boss：服务器按模板生成实例

---

### 2. 怪物实例表（monsters）- 仅用于Boss

**用途**：存储王城战Boss实例

**包含字段**：
- 怪物ID、模板ID、类型
- 当前状态（生命值、归属家族）
- 关联战场ID
- 击败者信息
- 生成/击败时间

**适用场景**：
- 仅用于王城战Boss
- 普通怪物不存储实例

---

### 3. 王城战战场表（battlefields）- 可选（用于关联Boss）

**用途**：管理王城战战场

**包含字段**：
- 战场ID
- A方家族ID、B方家族ID
- 战场状态（准备中/战斗中/已结束）
- 关联Boss ID
- 开始/结束时间

**说明**：
- 如果王城战逻辑简单，可以不需要独立表
- Boss表直接关联两个家族ID即可

---

## 实现方案

### 阶段1：普通怪物（优先实现）

1. **数据库**：
   - 创建 `monster_templates` 表
   - 插入普通怪物模板数据

2. **服务端**：
   - API：`GET /api/getMonsterTemplates` - 获取所有怪物模板
   - API：`POST /api/reportMonsterKill` - 记录击败数据（可选，用于统计）

3. **客户端**：
   - 从服务器获取模板
   - 按模板生成怪物
   - 击败后销毁，通知服务器（可选）

---

### 阶段2：王城战Boss（后续实现）

1. **数据库**：
   - 创建 `monsters` 表（仅用于Boss）
   - 可选：创建 `battlefields` 表

2. **服务端**：
   - API：`POST /api/createBattlefieldBoss` - 创建战场Boss
   - API：`GET /api/getBattlefieldBoss` - 获取战场Boss状态
   - API：`POST /api/attackBoss` - 攻击Boss
   - WebSocket：实时推送Boss状态变化

3. **客户端**：
   - 从服务器获取Boss状态
   - 实时显示Boss生命值、归属
   - 攻击Boss时调用API
   - 接收WebSocket推送更新状态

---

## 数据流

### 普通怪物流程

```
客户端 → 获取模板 → 生成怪物 → 玩家攻击 → 击败 → 销毁（不存储）
```

### 王城战Boss流程

```
服务器 → 创建战场 → 生成Boss → 存储到数据库
客户端 → 获取Boss状态 → 显示Boss
玩家攻击 → API调用 → 服务器计算伤害 → 更新数据库 → WebSocket推送 → 所有客户端更新
Boss被击败 → 更新归属 → 增加家族积分 → 推送结果
```

---

## 关键设计点

### 1. 普通怪物
- **不存储实例**：减少数据库压力
- **客户端生成**：每个玩家独立体验
- **简单快速**：适合日常刷怪

### 2. 王城战Boss
- **必须存储实例**：多玩家共享
- **服务器控制**：保证公平性
- **实时同步**：WebSocket推送状态
- **归属机制**：最后击败者获得归属
- **积分系统**：击败后增加家族积分

---

## 总结

**普通怪物**：轻量级，客户端生成，不存储实例
**王城战Boss**：重量级，服务器控制，存储实例，实时同步

这样的设计既保证了普通怪物的性能，又满足了Boss的复杂需求。

